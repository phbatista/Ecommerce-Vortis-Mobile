<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trocas - Vortis Mobile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<div id="navbar-placeholder"></div>

<div class="container mt-4">
    <h4>Solicitar Troca ou Devolução</h4>

    <form id="formTrocaDevolucao">
        <div class="mb-3">
            <label for="idPedido" class="form-label">ID do Pedido</label>
            <input type="number" class="form-control" id="idPedido" required>
        </div>

        <div class="mb-3">
            <label for="idProduto" class="form-label">ID do Produto</label>
            <input type="number" class="form-control" id="idProduto" required>
        </div>

        <div class="mb-3">
            <label for="quantidade" class="form-label">Quantidade</label>
            <input type="number" class="form-control" id="quantidade" min="1" required>
        </div>

        <div class="mb-3">
            <label for="motivo" class="form-label">Motivo</label>
            <textarea class="form-control" id="motivo" rows="3" required></textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">Tipo de Solicitação</label>
            <select class="form-select" id="tipo" required>
                <option value="">Selecione</option>
                <option value="TROCA">Troca</option>
                <option value="DEVOLUCAO">Devolução</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Enviar Solicitação</button>
    </form>
</div>

<script>
    document.getElementById("formTrocaDevolucao").addEventListener("submit", async (e) => {
        e.preventDefault();

        const dto = {
            idPedido: parseInt(document.getElementById("idPedido").value),
            idProduto: parseInt(document.getElementById("idProduto").value),
            quantidade: parseInt(document.getElementById("quantidade").value),
            motivo: document.getElementById("motivo").value,
            tipo: document.getElementById("tipo").value
        };

        try {
            const resp = await fetch("http://localhost:8080/api/vendas/solicitar-troca-ou-devolucao", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dto)
            });

            if (resp.ok) {
                alert("Solicitação enviada com sucesso!");
                document.getElementById("formTrocaDevolucao").reset();
            } else {
                const erro = await resp.text();
                alert("Erro ao enviar solicitação: " + erro);
            }
        } catch (err) {
            console.error("Erro na solicitação:", err);
            alert("Erro na comunicação com o servidor.");
        }
    });
</script>


<script src="/js/navbar/navbar.js"></script>
</body>
</html>